<!--
https://ae01.alicdn.com/kf/H96b9f137cdc448f8957bddda857d35b39.png
计算机基础
OSI七层模型
OSI七层模型包括：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层
OSI七层模型包括：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。在此基础上又简化出了TCP/IP四层模型
-->

## OSI七层模型

> OSI七层模型包括：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。在此基础上又简化出了TCP/IP四层模型


![模型](https://ae01.alicdn.com/kf/Hf2f9decfc8aa41af9a6d8115d23f8525q.png)

我们从底层说起：
#### 物理层
设备之间，通信的基础，即保证设备之间能够传输电信号。即电子信号0和1。一般是网线等。

#### 数据链路层
在设备之间能够保证基本通信的基础上，我们仍需要保证电信号的可识别性。也就是所谓的协议。

协议是设备之间通信的准则，如苹果和华为，他们之间的设备可能就不能够很好的相互调用某些功能，
因为他们定义有自己的协议。保证只有自己的设备才能够进行通信。

只有都遵守某个协议，公共设备才可以有的相互通信的条件。以太网协议，是目前公认的互联网协议，
以一组电信号为一个数据包，或者叫一帧，该数据包内由两部分组成，即标头和数据，其中标头用来存放识别和寻址等信息。

在数据链路层，我们主要通过MAC地址来进行识别。MAC地址由48位二进制组成，一般由12位16进制表示，
前6位16进制表示厂商，后6位进制表示流水号。MAC地址是每一个网卡的唯一标识，当设备需要与其他设备进行通信的时候，
需要拥有网卡，然后交互过程，也并非是一对一的精直接准送达，将目标的MAC地址写入标头，然后通过网咯交换机广播给
子网内的所有设备，设备接收到数据包后，对比MAC地址，即可识别。

#### 网络层
网络层，定义有IP协议，即提供IP地址和子网掩码的概念。如在上述链路层举例中，网络交换机广播数据包给子网内所有设备。
如何知道设备时否时同一子网内，则需要通过网络层的IP协议来定位。

IP地址有IPV4和IPV6，一般IPV4使用较多，是由32位二进制组成，一般由4位十进制来表示，前24位二进制表示网络，
后8位表示主机设备序号。同一子网内的设备，其网络部分一定时相同的，可以通过IP地址和子网掩码进行求与计算来判断。
不是纯粹的通过IP地址，这里需要子网掩码的一些计算。

故有了网络层，即可保证在局域网内设备之间的通信。而不再局域网内的设备，则需要通过路由来发送数据包。

<!-- 
访问的原理就是你所在的子网，需要和其他子网进行通信 
-->
路由器包含多个网卡，负责将多个子网进行连接。网关也是路由器的一种，运作在网络层，我们可以将路由器上的IP地址，
认为是网关。路由器上每一个网卡都有IP地址和MAC地址，路由器本身也有MAC地址，但是不用做寻址，而是使用IP地址，
故路由器是作用在网络层的设备。

网络交换机，是工作在数据链路层的设备，通过mac地址来寻址和传包。主要用在局域网内的通信。
即局域网被的设备通过数据链路层发送数据包，通过网络交换机来广播，通过mac地址来寻址。

路由，是工作在网络层，通过ip地址来寻址和传包，一般用来连入internet。  
LAN为局域网、WAN为广域网、WLAN无限局域网

路由器，一般包含网络交换机和路由的功能。当两个不提供局域网，内的设备进行通信，通过同一路由进行通信的时候：  
（局域网内设备都遵循ARP cache协议，即会保存该局域网内所有设备的ip地址与mac地址的对应关系，那么可以通过ip地址转化mac地址）  
1、将目标的设备所在网卡的mac写入，将目标设备ip地址写入  
2、路由器根据mac地址查询到自己设备，并将数据包转交  
3、根据ARP cache协议，将目标ip地址转化为mac地址，通过对方局域网内的网络交换机广播数据包

#### 传输层
传输层，定义有TCP协议，即通信过程，需要指定端口号，实现点对点通信，而不是将此次数据包交给该设备上的所有程序。

网络层是基于IP协议，用于设备与设备之间寻址和通信的。  
传输层是建立两个设备的两个端口之间的连接和通信。

这里也就是socket通信。包udp和tcp协议，其中udp是不可靠的，而tcp是需要通过三次握手建立连接。  
传输层通过TCP协议，实现端口对端口的连接与通信。

#### 应用层
数据通过传输层，目标设备的应用基本已经可以收到对方传来的数据包。这些数据如何处理，则又有新的协议，定义再应用层。
常见的有http协议，不同应用之间协议可能不同。

#### 总结
1、ip地址和mac地址，可以唯一定位网卡。  
2、ip地址和子网掩码，可以定位设备是否属于局域网设备。  
3、路由器网卡，也有ip地址、mac地址，也可以理解为我们设备的网关地址。遵循ARP cache协议，该网卡局域网内所有设备，
均可以通过对方的ip地址找到对方的mac地址。
4、在子网内，通过mac地址、以太网协议、网络交换机广播数据。
5、不在同一子网内，先通过mac地址广播到网关，交由网关传播到其他网关。直到被目标网关接收。


![数据包格式](https://ae01.alicdn.com/kf/He7e84aeef1ef48f49c50d46a440949d6c.png)
最外层为数据链路层，包含目标mac地址和源mac地址  
其次是网络层，包含IP协议数据，即目标IP和源IP地址等信息  
再就是传输层，包含TCP协议数据，即目标端口号和源端口号等信息

#### 用浏览器访问，经历了那些过程
![浏览器访问流程](https://ae01.alicdn.com/kf/H3241c23a3d8743da8ca39a30e8612a68w.png)
1、在浏览器中输入域名地址   
2、访问DNS服务器，获取该域名绑定的IP地址    
3、通过子网掩码，得知此域名并非同一子网内，接着应用层生成http请求报文    
4、通过传输层，将报文放到数据包的数据中，在标头写入目标端口和本应用端口  
5、通过网络层，将传输层数据放到数据中，在标头写入目标ip地址和本机ip地址
6、通过数据链路层，将网络层数据放到数据中，在表头写入本机mac地址和网关的mac地址  
7、通过网络交换机广播到网关，再交由网关转发其他网关，直至到达目标子网内   

其中，一次数据链路包，最多不能超过1500字节，当数据较大时，需要切包发送
